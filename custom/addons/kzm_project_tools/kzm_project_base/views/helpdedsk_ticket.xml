<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <data>
        <record model="ir.ui.view" id="helpdesk_ticket_view_inherits_ot1">
            <field name="name">Tickets</field>
            <field name="model">helpdesk.ticket</field>
            <field name="inherit_id" ref="helpdesk.helpdesk_ticket_view_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='partner_id']" position="after">
                    <field name="contract_id" invisible="0" options="{'no_create': True}"/>
                    <field name="domain_task" invisible="1"/>
                    <field name="internal_type" invisible="1"/>
                    <field name="is_timesheet" invisible="1"/>
                    <field name="write_task" invisible="1"/>
<!--                    <field name="is_clotured" invisible="1"/>-->

                    <field name="task_id" options="{'no_create': True}" required="1" attrs="{'readonly': [('is_timesheet', '=', True),('write_task', '=', False)]}" force_save="1"/>
                    <field name="sold" widget="float_time"/>
                </xpath>
                <xpath expr="//field[@name='partner_id']" position="attributes">
                    <attribute name="required">1</attribute>
                    <attribute name="options">{'no_create': True}</attribute>
                    <attribute name="attrs">{'readonly':[('is_timesheet','=',True)]}</attribute>
                </xpath>
                <xpath expr="//field[@name='partner_name']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>


                 <xpath expr="//button[@name='assign_ticket_to_self']" position="after">
                        <button name="affect_ticket" string="RÃ©affecter" type="object" class="oe_highlight"
                                groups="project.group_project_manager"/>
                 </xpath>

                <xpath expr="//field[@name='tag_ids']" position="after">
                    <field name="custom_tag_ids" widget="many2many_tags" readonly="1"/>
                    <field name="planned_date"/>
                    <field name="estimated_charge" widget="float_time"/>
                    <field name="real_charge" widget="float_time"/>
                    <field name="real_charge_portal" widget="float_time" groups="kzm_project_base.group_charge_access"/>
                    <field name="create_date"/>
                </xpath>
                <xpath expr="//label[@for='partner_email']" position="replace">
                </xpath>
                <xpath expr="//div[@class='o_row o_row_readonly'][1]" position="replace">
                </xpath>
                <xpath expr="//field[@name='partner_id']" position="after">
                    <label for="partner_email" string="Email"/>
                    <div class="o_row o_row_readonly">
                        <field name="partner_email" widget="email" string="email"/>
                        <span class="fa fa-exclamation-triangle text-warning oe_edit_only"
                              title="By saving this change, the customer email will also be updated."
                              attrs="{'invisible': [('is_partner_email_update', '=', False)]}"/>
                    </div>
                </xpath>
            </field>
        </record>
        <record model="ir.ui.view" id="helpdesk_ticket_view_inherits_ot2">
            <field name="name">Tickets</field>
            <field name="model">helpdesk.ticket</field>
            <field name="inherit_id" ref="helpdesk_timesheet.helpdesk_ticket_view_form_inherit_helpdesk_timesheet"/>
            <field name="arch" type="xml">
                <xpath expr="//tree/field[@name='employee_id']" position="after">
                    <field name="contract_id" invisible="1"/>
                    <field name="task_id" invisible="1"/>
                    <field name="project_id" invisible="1"/>
                    <field name="type" invisible="1"/>
                </xpath>
                <xpath expr="//field[@name='timesheet_ids']" position="attributes">
                    <attribute name="context">{'default_contract_id': contract_id,
                        'default_partner_id': partner_id}
                    </attribute>
                </xpath>

                <xpath expr="//field[@name='timesheet_ids']/tree" position="attributes">
                    <attribute name="delete">0</attribute>
                </xpath>

                <xpath expr="//page[@name='timesheets']" position="attributes">
                    <attribute name="attrs">{'invisible': ['|',('task_id', '=', False),('create_date', '=', False)]}</attribute>
                </xpath>


            </field>
        </record>
        <record model="ir.ui.view" id="helpdesk_stages_view_inherits_ot2">
            <field name="name">Tickets stages</field>
            <field name="model">helpdesk.stage</field>
            <field name="inherit_id" ref="helpdesk.helpdesk_stage_view_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='team_ids']" position="after">
                    <field name="is_client_feedback"/>
                    <field name="is_clotured"/>
                </xpath>
            </field>
        </record>
    </data>
</odoo>
