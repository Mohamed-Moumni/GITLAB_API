<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <data>
        <!-- explicit list view definition -->

        <record model="ir.ui.view" id="sold_task_derogation_form">
            <field name="name">Derogation</field>
            <field name="model">sold.task.derogation</field>
            <field name="arch" type="xml">
                <form>
                    <header>
                        <button name="set_to_on_hold" type="object" string="request approbation" states="draft" groups="kzm_project_base.group_approver_access,kzm_project_base.group_asker_access"/>
                        <button name="set_to_validate" type="object" string="Validate" states="on_hold" groups="kzm_project_base.group_approver_access"/>
                        <button name="set_to_refuse" type="object" string="Refuse" states="on_hold" groups="kzm_project_base.group_approver_access"/>
                        <button name="set_to_draft" type="object" string="Reset to draft" states="validated,refused" groups="kzm_project_base.group_approver_access"/>
                        <field name="state" widget="statusbar"/>
                    </header>
                    <sheet>
                        <div class="oe_title">
                            <label for="name" class="oe_edit_only"/>
                            <h1>
                                <field name="name"/>
                            </h1>
                        </div>
                        <group>
                            <group>

                                <field name="type" attrs="{'readonly': [('state', '=', 'validated')]}" widget="radio"/>
<!--                                <field name="partner_id"/>-->
                                <field name="contract_id"/>
                                <field name="name_ticket" attrs="{'invisible': [('type', '!=', 'new_task')], 'required':[('type', '=', 'new_task')]}"/>
                                <field name="task_id" attrs="{'invisible': [('type', '=', 'new_task')], 'required':[('type', '!=', 'new_task')], 'readonly': [('contract_id', '=', False)]}" domain="[('contract_id','=',contract_id)]"/>
                                <field name="estimated_time" widget="float_time"/>
                            </group>
                            <group>
                                <field name="user_id" required="1"/>
                                <field name="date"/>
                                <field name="created_task_id" attrs="{'invisible': [('type', '!=', 'new_task')]}" readonly="1"/>
<!--                                <field name="project_id"/>-->
                                <field name="initial_sold" attrs="{'invisible': [('type', '=', 'new_task')]}"/>
                                <field name="sold" attrs="{'invisible': [('type', '=', 'new_task')]}"/>
                            </group>
                        </group>
                        <notebook>
                            <page string="Pattern" name="description">
                                <field name="pattern" placeholder="Description of pattern..."/>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="sold_task_derogation_list">
            <field name="name">Derogation</field>
            <field name="model">sold.task.derogation</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="name"/>
                    <field name="user_id"/>
<!--                    <field name="partner_id"/>-->
                    <field name="contract_id"/>
                    <field name="task_id"/>
                    <field name="date"/>
                    <field name="state" optional="show" widget="badge" decoration-success="state == 'validated'"
                           decoration-info="state == 'draft'"
                           decoration-warning="state == 'in_hold'"
                           decoration-danger="state == 'refused'"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="sold_task_derogation_search">
            <field name="name">Derogation</field>
            <field name="model">sold.task.derogation</field>
            <field name="arch" type="xml">
                <search>
                    <field name="name"/>
                    <field name="user_id"/>
                    <group expand="0" name="group_by" string="Group By">
<!--                        <filter-->
<!--                                name="filter_partner_id"-->
<!--                                string="Client"-->
<!--                                context="{'group_by' : 'partner_id'}"-->
<!--                        />-->
                        <filter
                                name="filter_state"
                                string="State"
                                context="{'group_by' : 'state'}"
                        />
                    </group>
                </search>
            </field>
        </record>


        <!-- actions opening views on models -->

        <record model="ir.actions.act_window" id="sold_task_derogation_action_window">
            <field name="name">Derogation</field>
            <field name="res_model">sold.task.derogation</field>
            <field name="view_mode">tree,form</field>
        </record>


        <menuitem name="Derogation" id="kzm_sold_task_derogation_menu" action="kzm_project_base.sold_task_derogation_action_window" web_icon="kzm_project_base,static/icon_derogation.png"/>


        <record model="ir.ui.view" id="project_task_type_view_inherits_ot2">
            <field name="name">project.task.type.inherits1</field>
            <field name="model">project.task.type</field>
            <field name="inherit_id" ref="project.task_type_edit"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='project_ids']" position="after">
                    <field name="is_progress"/>
                </xpath>
            </field>
        </record>
    </data>
</odoo>
