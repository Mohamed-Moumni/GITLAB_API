<?xml version="1.0" encoding="utf-8"?>

<odoo>
    <data>
        <record id="view_hr_employee_kzm_inherited_2" model="ir.ui.view">
            <field name="name">hr.employee.form.kzm.inherited.2</field>
            <field name="model">hr.employee</field>
            <field name="inherit_id" ref="hr.view_employee_form"/>
            <field name="arch" type="xml">
                <xpath expr="//notebook" position="inside">
                    <page string="Periodic Evaluation Plan">
                        <field name="plan_evaluation_ids">
                            <tree string="Evaluation plans">
                                <field name="date_plan"/>
                                <field name="employe_id"/>
                                <field name="period_str"/>
                                <field name="note"/>
                                <field name="classe"/>
                            </tree>
                        </field>
                    </page>
                </xpath>
            </field>
        </record>

        <!-- team line project -->
        <record id="team_line_project_form_view" model="ir.ui.view">
            <field name="name">project.team.line.eval.form</field>
            <field name="model">project.team.line.eval</field>
            <field name="arch" type="xml">
                <form string="Team eval project">
                    <sheet>
                        <group>
                            <group>
                                <field name="employee_id"/>
                                <field name="team_availability"/>
                            </group>
                            <group>
                                <field name="project_id"/>
                                <field name="mean_note"/>
                            </group>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="team_line_eval_tree_view" model="ir.ui.view">
            <field name="name">project.team.line.eval.tree</field>
            <field name="model">project.team.line.eval</field>
            <field name="arch" type="xml">
                <tree string="Teams eval project">
                    <field name="employee_id"/>
                    <field name="project_id"/>
                    <field name="mean_note"/>
                    <field name="team_availability"/>
                </tree>
            </field>
        </record>

        <record id="team_line_eval_search_view" model="ir.ui.view">
            <field name="name">project.team.line.eval.search</field>
            <field name="model">project.team.line.eval</field>
            <field name="priority">1</field>
            <field name="arch" type="xml">
                <search string="Search team line">
                    <field name="employee_id" string="Name"/>
                    <field name="project_id"/>
                </search>
            </field>
        </record>

        <record id="team_eval_action" model="ir.actions.act_window">
            <field name="name">Team project eval</field>
            <field name="res_model">project.team.line.eval</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="search_view_id" ref="team_line_eval_search_view"/>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                    Click to add a team eval project.
                </p>
            </field>
        </record>

        <record id="team_eval_action_kanban" model="ir.actions.act_window">
            <field name="name">Team project eval</field>
            <field name="res_model">project.team.line.eval</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="search_view_id" ref="team_line_eval_search_view"/>
            <field name="context">{'default_project_id': active_id, 'search_project_id': active_id}</field>
            <field name="domain">[('project_id','=', active_id)]</field>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                    Click to add a team eval project.
                </p>
            </field>
        </record>

        <record id="task_evolution_action" model="ir.actions.act_window">
            <field name="name">Evaluations</field>
            <field name="res_model">kzm.hr.evaluation.eval</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="search_view_id" ref="kzm_hr_evaluation.evaluation_eval_search_view"/>
            <field name="context">{'default_task_id': active_id, 'search_task_id': active_id}</field>
            <field name="domain">[('task_id','=', active_id)]</field>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                    Click to add an Evaluation.
                </p>
            </field>
        </record>

        <record model="ir.ui.view" id="eval_view_task_form2_inherited_2">
            <field name="name">project.task.form.kzm.inherit2</field>
            <field name="model">project.task</field>
            <field name="inherit_id" ref="project.view_task_form2"/>
            <field name="arch" type="xml">
                <xpath expr="//div[@ class='oe_button_box']" position="inside">
                    <button class="oe_stat_button" name="%(task_evolution_action)d" type="action" icon="fa-th-large">
                        <field string="Evolutions" name="evolutions_count" widget="statinfo"/>
                    </button>
                </xpath>
                <xpath expr="//notebook" position="inside">
                    <page string="Evaluations">
                        <field name="hr_evaluation_ids">
                            <tree string="Evaluations" editable="top">
                                <field name="name"/>
                                <field name="date_eval"/>
                                <field name="hr_modele_id"/>
                                <field name="employe_id"/>
                                <field name="hr_axe_id" readonly="1"/>
                                <field name="mean_note"/>
                            </tree>
                        </field>
                    </page>
                </xpath>
            </field>
        </record>


        <record model="ir.ui.view" id="eval_edit_project_form_inherited_2">
            <field name="name">project.project.form.kzm.inherit</field>
            <field name="model">project.project</field>
            <field name="inherit_id" ref="kzm_project_followup.eval_edit_project_form_inherited"/>
            <field name="arch" type="xml">
                <xpath expr="//page[@name='chiffProject']" position="after">
                    <page name="EvaluationProject" string="Evaluation project"  groups="project.group_project_manager">
                        <group>
                            <group>
                                <field name="mean_note_team"/>
                            </group>
                            <group>
                                <field name="hr_modele_id"/>
                            </group>
                        </group>
                        <h2 class="o_horizontal_separator">Evaluations</h2>
                        <field name="hr_evaluation_ids" domain="[('project_id','=',id)]"
                               context="{'default_project_id': id, 'default_hr_modele_id':hr_modele_id}">
                            <tree string="Evaluations" editable="top">
                                <field name="name"/>
                                <field name="date_eval"/>
                                <field name="hr_modele_id"/>
                                <field name="employe_id"/>
                                <field name="hr_axe_id"/>
                                <field name="mean_note"/>
                            </tree>
                        </field>

                        <h2 class="o_horizontal_separator">Team Project</h2>
                        <field name="team_line_ids" domain="[('project_id','=',id)]"
                               context="{'default_project_id': id}">
                            <tree string="Project team line" editable="top">
                                <field name="employee_id"/>
                                <field name="mean_note"/>
                                <field name="team_availability"/>
                            </tree>
                        </field>
                    </page>
                </xpath>

            </field>
        </record>

        <record id="view_hr_employee_kzm_inherited_2" model="ir.ui.view">
            <field name="name">hr.employee.form.kzm.inherited_2</field>
            <field name="model">hr.employee</field>
            <field name="inherit_id" ref="hr.view_employee_form"/>
            <field name="arch" type="xml">
                <xpath expr="//notebook" position="inside">
                    <field name="id" invisible="1"/>
                    <page string="Periodic plan evaluations">
                        <field name="plan_evaluation_ids" domain="[('employee_id','=',id)]"
                               context="{'default_employee_id': id}">
                            <tree>
                                <field name="date_plan"/>
                                <field name="period_str"/>
                                <field name="note"/>
                                <field name="classe"/>
                            </tree>
                        </field>
                    </page>
                </xpath>
                <xpath expr="//notebook" position="before">
                    <group>
                        <group>
                            <field name="days_week_works"/>
                        </group>
                    </group>
                </xpath>
            </field>
        </record>

        <record id="evaluation_eval_form_view_inherited" model="ir.ui.view">
            <field name="name">hr.evaluation.eval.inherited</field>
            <field name="model">kzm.hr.evaluation.eval</field>
            <field name="inherit_id" ref="kzm_hr_evaluation.evaluation_eval_form_view"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='hr_axe_id']" position="after">
                    <field name="task_id" domain="[('project_id','=',project_id)]"/>
                    <field name="project_id"/>
                </xpath>
            </field>
        </record>

        <record id="evaluation_eval_action_kanban" model="ir.actions.act_window">
            <field name="name">Evaluations</field>
            <field name="res_model">kzm.hr.evaluation.eval</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="search_view_id" ref="kzm_hr_evaluation.evaluation_eval_search_view"/>
            <field name="context">{'default_project_id': active_id, 'search_project_id': active_id}</field>
            <field name="domain">[('project_id','=', active_id)]</field>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                    Click to add an Evaluation.
                </p>
            </field>
        </record>

        <record id="view_edit_project_kzm_inherited_2" model="ir.ui.view">
            <field name="name">project.project.form.kzm.inherited_2</field>
            <field name="model">project.project</field>
            <field name="inherit_id" ref="project.edit_project"/>
            <field name="arch" type="xml">
                <xpath expr="//div[@ class='oe_button_box']/button [2]" position="after">
                    <button class="oe_stat_button" name="%(team_eval_action_kanban)d" type="action" icon="fa-th-large">
                        <field string="Project teams" name="nb_team_line" widget="statinfo"/>
                    </button>
                    <button class="oe_stat_button" name="%(evaluation_eval_action_kanban)d" type="action"
                            icon="fa-th-large">
                        <field string="Evaluations" name="nb_evaluations" widget="statinfo"/>
                    </button>
                </xpath>
            </field>
        </record>

        <record model="ir.ui.view" id="view_project_kanban_kzm_eval_2">
            <field name="name">project.project.kanban.kzm.inherit.2</field>
            <field name="model">project.project</field>
            <field name="inherit_id" ref="project.view_project_kanban"/>
            <field name="arch" type="xml">
                <xpath expr="/kanban/field[@name='task_count']" position="after">
                    <field name="nb_evaluations" groups="project.group_project_manager"/>
                    <field name="nb_team_line" groups="project.group_project_manager"/>
                </xpath>

                <xpath expr="//div[contains(@class, 'o_kanban_manage_reports')]/div[last()]" position="after">
                    <div groups="project.group_project_manager">
                        <a name="%(team_eval_action_kanban)d"
                           type="action"
                           context="{'default_project_id': active_id, 'search_project_id': active_id}"
                           domain="[('project_id','=', active_id)]">
                            <span class="o_label">Teams project (<t t-esc="record.nb_team_line.value"/>)
                            </span>
                        </a>
                        <a name="%(evaluation_eval_action_kanban)d"
                           type="action"
                           context="{'default_project_id': active_id, 'search_project_id':active_id}"
                           domain="[('project_id','=', active_id)]">
                            <span>Evaluations (<t t-esc="record.nb_evaluations.value"/>)
                            </span>
                        </a>
                    </div>
                </xpath>
                <xpath expr="//div[contains(@class, 'o_project_kanban_box')]" position="before">
                    <div class="o_project_kanban_box" groups="project.group_project_manager">
                        <a name="%(team_eval_action_kanban)d"
                           type="action"
                           context="{'default_project_id': active_id, 'search_project_id': active_id}"
                           domain="[('project_id','=', active_id)]">
                            <span class="o_value">
                                <t t-esc="record.nb_team_line.value"/>
                            </span>
                            <span class="o_label">Teams project</span>
                        </a>
                    </div>
                </xpath>
            </field>
        </record>

    </data>
</odoo>
