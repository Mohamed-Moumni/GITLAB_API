<?xml version="1.0" encoding="UTF-8" ?>
<odoo>

    <record id="mail_template_recap_backup" model="mail.template">
        <field name="name">Recap Backup</field>
        <field name="subject">Backup Recap for {{ ctx.get('date')}}</field>
        <field name="email_to">{{ ctx.get('email_to')}}</field>
        <field name="partner_to">{{ ctx.get('partner_to')}}</field>
        <field name="model_id" ref="kzm_backup_tracker.model_kzm_backup_tracker_gantt"/>
        <field name="body_html" type="html">
            <div style="margin: 0px; padding: 0px; font-size: 14px;">
                <p style="margin: 0px; padding: 0px; font-size: 14px;">
                    Hello,
                    <br/>
                    This is the databases backup status for
                    <strong>
                        <t t-out="ctx.get('date')"/>
                    </strong>
                    <br/>
                    <br/>
                    <t t-set="lines" t-value="ctx.get('failed_records')"/>
                    <t t-if="lines">
                        There are
                        <t t-out="len(lines)"/>
                        database backup alerts for today.
                        <br/>
                        <br/>
                        The following databases have not been backed up:
                        <br/>
                        <table class="table table-bordered">
                            <tr>
                                <th style="background:#664A5F; color:white">Bucket Name</th>
                                <th style="background:#664A5F; color:white">Backup Path</th>
                                <!--                            <th style="background:#664A5F; color:white">Backup Name</th>
                                                            <th style="background:#664A5F; color:white">Status</th>-->

                            </tr>
                            <t t-foreach="lines" t-as="line">
                                <tr>
                                    <td style="background:#CA322C; color:white">
                                        <t t-out="line.backup_name"/>
                                    </td>
                                    <td style="background:#CA322C; color:white">
                                        <t t-out="line.backup_path"/>
                                    </td>
                                    <!--<td style="background:#CA322C; color:white">
                                        <t t-out="line.name"/>
                                    </td>
                                    <td style="background:#CA322C; color:white">
                                        Alert
                                    </td>-->

                                </tr>
                            </t>

                        </table>
                        <br/>
                        <br/>
                    </t>
                    <t t-set="double_backups" t-value="ctx.get('double_records')"/>
                    <t t-if="double_backups">
                        <br/>
                        The following databases have been backed up more than once:
                        <br/>
                        <table class="table table-bordered">
                            <tr>
                                <th style="background:#664A5F; color:white">Bucket Name</th>
                                <th style="background:#664A5F; color:white">Backup Path</th>
<!--                                <th style="background:#664A5F; color:white">Backup Name</th>-->
<!--                                <th style="background:#664A5F; color:white">Status</th>-->

                            </tr>
                            <t t-set="done_backup" t-value="[]" />
                            <t t-foreach="double_backups" t-as="l">
                                <t t-if="l.backup_name not in done_backup">
                                    <tr>
                                    <td  style="background:#F7C600; color:white">
                                        <t t-out="l.backup_name"/>
                                    </td>
                                    <td  style="background:#F7C600; color:white">
                                        <t t-out="l.backup_path"/>
                                    </td>
                                        <t t-set="done_backup" t-value="done_backup + [l.backup_name]" />

                                </tr>
                                </t>

                            </t>

                        </table>
                        <br/>
                        <br/>
                    </t>

                    Sincerely,

                </p>
            </div>


        </field>
    </record>

</odoo>
